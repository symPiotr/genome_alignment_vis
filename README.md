# genome_alignment_vis

This draft workflow makes a nucmer- or promer-like plot comparing genomes within two FASTA files, and visualizes the contigs using pre-defined colors.

Inputs include:  
  1) Reference FASTA file
  2) Reference GFF file made by the symCAP script
  3) Query FASTA file, with one or more genomes
  4) Query GFF file, for one genome - or concatenated GFFs for many or more genomes
  5) File with information on gene categories to be highlighted, genes in each category

The steps include:
  1) Converting Query and Reference GFFs to a simplified csv output: Python 3 script **process_gff_20250307.py**
  2) Conduct a tblastx-based comparison of Query vs Reference, parse the results, add query annotation information, and export ready-for-visualization file: Python 3 script **visualize_genome_comparisons_20250307.py**
  3) Visualize the resulting files: Processing 3 (Python mode) script **Promer_style_genome_comparison_alignment_20250221**
... and are described in more details below.

Example workflow:
```
cp Sulc_gffs/SMOLIH.gff .
cp Sulc_genomes/SMOLIH.fasta .
cat Sulc_genomes/SMP* > SMPs.fasta
cat Sulc_gffs/SMP* > SMPs.gff
./process_gff_20250307.py
./process_gff_20250307.py SMOLIH.gff Sulcia_gene_categories.txt > SMOLIH.pro
./process_gff_20250307.py SMPs.gff Sulcia_gene_categories.txt > SMPs.pro
./visualize_genome_comparison_20250307.py
./visualize_genome_comparison_20250307.py SMOLIH.fasta SMPs.fasta SMPs.pro SMPs_vs_SMOLIH.csv

### ... and then use the resulting files SMPs_vs_SMOLIH.csv and SMPs.gff
### ... for Processing visualization using promer_style_genome_comparison_alignment_20250221.pyde
```

    
### process_gff_20250307.py
This Python 3 script processes a GFF file, such as the one made by the symCAP script, to a simplified format for visualization.

Usage:
```
./process_gff_20250307.py              
This script processes a gff file - like the one produced by symCAP script -
and the second tab-delimited file with info on assignment of genes to pre-defned categories,
and returns to stdout a table to be used as an input of genome_plotting.
It direct the output to STDOUT - you probably want to redirect it to a file instead.
Usage: ./process_gff_20250307.py <gff_file> <categories_file>

./process_gff_20250307.py SMOLIH.gff Sulcia_gene_categories.txt > SMOLIH.pro 
```

Example input - `SMDICMUL.gff`:
```
##gff-version 3
##sequence-region  SMOLIH 1 156579
SMOLIH	HMMER_3.1b2	gene	4	681	.	+	0	ID=gene_001;locus_tag=SMOLIH_001;gbkey=Gene;gene_biotype=protein_coding;gene=lipB;name=lipB;
SMOLIH	HMMER_3.1b2	CDS	4	681	.	+	0	ID=product_001;Parent=gene_001;locus_tag=SMOLIH_001;gbkey=CDS;gene=lipB;product=Octanoyltransferase;transl_table=11;codon_start=1
SMOLIH	HMMER_3.1b2	gene	649	1986	.	-	0	ID=gene_002;locus_tag=SMOLIH_002;gbkey=Gene;gene_biotype=protein_coding;gene=hisS;name=hisS;
SMOLIH	HMMER_3.1b2	CDS	649	1986	.	-	0	ID=product_002;Parent=gene_002;locus_tag=SMOLIH_002;gbkey=CDS;gene=hisS;product=Histidine--tRNA ligase;transl_table=11;codon_start=1
```

Example input - `Sulcia_gene_categories.txt`:
```
lipB	Metabolism
valS	Genetic_information_processing
```

Example output - `SMOLIH.pro`:
```
genome_entry,SMOLIH,156579,
SMOLIH,lipB,Metabolism,4,681,+,
SMOLIH,hisS,Genetic_information_processing,649,1986,-,
SMOLIH,valS,Genetic_information_processing,2038,4599,+,
SMOLIH,rsfS,Genetic_information_processing,4652,4954,+,
```

### visualize_genome_comparison_20250307.py
This Python 3 script inputs two nucleotide FASTA files (reference and query genomes), plus a processed-GFF ('PRO') file for the query generated by "process_gff_20250307.py".
It makes blast databases in references and conducts tblastx search.
Then, it parses the output: for each nucleotide position in the query, it attempts to find the corresponding position in the reference, and then adds information on the annotation of that position.
It outputs a file with information for every 30th position that can be used for visualization using Processing.  

Usage:
```
./visualize_genome_comparison_20250307.py 
This script inputs two fasta files (reference and query), plus an output file generated by "process_gff_20250307.py".
It outputs a file with info for visualization using Processing.
Usage: visualize_genome_comparizon_20250307.py <reference_fasta> <query_fasta> <processed_query_gff_file> <output_file_name>

For now, make sure to run the script while in the folder with the input files!
./visualize_genome_comparison_20250307.py SMOLIH.fasta SMPs.fasta SMPs.pro SMPs_vs_SMOLIH.csv
```

Example output - `SMPs_vs_SMOLIH.csv`:
```
genome_entry,SMPARIOC,144413
SMPARIOC,1,NA,NA,lipB,Metabolism
SMPARIOC,31,142.0,+,lipB,Metabolism
SMPARIOC,61,172.0,+,lipB,Metabolism
SMPARIOC,91,208.0,+,lipB,Metabolism
SMPARIOC,121,238.0,+,lipB,Metabolism
```

### promer_style_genome_comparison_alignment_20250221.pyde
This Processing 3 (Python mode) script inputs the visualization file provided by "visualize_genome_comparison_20250307.py", plus a processed-GFF ('PRO') file for the reference generated by "process_gff_20250307.py". For subsequent positions (bases) in the visualization file, it draws colored lines at the correct positions.  
It also draws a series of rectangles corresponding to different genes of the reference genome. They may be manually extended into semi-transparent boxes (the portion of the script currently  commented out).
The script saves output as PDF.

As of now, many parameters such as genome scales need to be updated manually within the script.

